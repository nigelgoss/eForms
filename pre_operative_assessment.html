<!DOCTYPE html>
<html lang="en">
	
	<head>
		
		<meta charset="UTF-8">
		<title>Pre Operative Assessment</title>
		<meta name="viewport" content="initial-scale=1.0">
		
		<link rel="stylesheet" href="resources/main.css">
		
		<style>
		
			body > div { border:1px solid lightgrey; }
			body > div + div { margin-top:10px; }
			div { padding:10px; }
			label { cursor:pointer; }
			label + label { margin-left:25px; }
			textarea { width:100%; height:50px; resize:none; }
			button { background-color:#007f3b; color:#ffffff; border:0; padding:10px; border-radius:5px; }
			
		</style>
		
		<script>
			
			if (!NodeList.prototype.forEach) { NodeList.prototype.forEach = Array.prototype.forEach; };
			
			var disabled = false;
			
			function process () {
				
				if (disabled === true) return;
				disabled = true;
				
				var $d = {};
				document.querySelectorAll("*[name]").forEach(function ($v) {
					$d[$v.name] = ($v.value === "") ? null : $v.value;
				});
				
				var $e = [];
				if ($d["Q1"] === null) {
					$e.push("Question 1");
				};

				if ($e.length > 0) {
					
					alert("Errors:\n- " + $e.join("\n- "));
					disabled = false;
					
				} else {
				
					var xhr = new XMLHttpRequest();
					xhr.onreadystatechange = function () {
						if (xhr.readyState !== 4) return;
						disabled = false;
						if (xhr.status !== 200) {
							alert("There has been an error with the submission. Please retry.");
						} else {
							location.href = ".";
						};
					};
					xhr.open("GET", ".", true);
					xhr.send();

					console.log(JSON.stringify([location.hash.split("#")[1], $d]));
					
				};
				
			};
			
		</script>
		
	</head>

	<body>

		
		
		<div>
			<div style="text-align:center; font-weight:bold; font-size:2em;">
				XXX
			</div>
			<div>
				YYY
			</div>
		</div>
		
		<div>
			<div>1) Has the proposed operation been explained to you?</div>
			<div>
				<label><input type="radio" name="OperationExplained" value="Yes" />Yes</label>
				<label><input type="radio" name="OperationExplained" value="No" />No</label>
			</div>
		</div>

		<div>
			<div>2) Are you willing to have the proposed operation?</div>
			<div>
				<label><input type="radio" name="OperationWilling" value="Yes" />Yes</label>
				<label><input type="radio" name="OperationWilling" value="No" />No</label>
			</div>
		</div>
		
		<div>
			<div>3) Please use this space for any other comments you have</div>
			<div>
				<textarea name="OperationWilling"></textarea>
			</div>
		</div>

		<div style="text-align:center;">
			<button onpointerdown="process();">Finish and Send</button>
		</div>
			
	</body>
	
</html>
