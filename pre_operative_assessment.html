<!DOCTYPE html>
<html lang="en">
	
	<head>
		
		<meta charset="UTF-8">
		<title>Pre Operative Assessment</title>
		<meta name="viewport" content="initial-scale=1.0">
		
		<link rel="stylesheet" href="resources/main.css">
		
		<style>
		
			body > div { border:1px solid lightgrey; padding:10px; }
			body > div + div { margin-top:10px; }
			
		</style>
		
		<script>
			
			if (!NodeList.prototype.forEach) { NodeList.prototype.forEach = Array.prototype.forEach; };
			
			var disabled = false;
			
			function process () {
				
				if (disabled === true) return;
				disabled = true;
				
				var $d = {};
				document.querySelectorAll("*[name]").forEach(function ($v) {
					$d[$v.name] = ($v.value === "") ? null : $v.value;
				});
				
				var $e = [];
				if ($d["Q1"] === null) {
					$e.push("Question 1");
				};

				if ($e.length > 0) {
					
					alert("Errors:\n- " + $e.join("\n- "));
					disabled = false;
					
				} else {
				
					var xhr = new XMLHttpRequest();
					xhr.onreadystatechange = function () {
						if (xhr.readyState !== 4) return;
						disabled = false;
						if (xhr.status !== 200) {
							alert("There has been an error with the submission. Please retry.");
						} else {
							location.href = ".";
						};
					};
					xhr.open("GET", ".", true);
					xhr.send();

					console.log(JSON.stringify([location.hash.split("#")[1], $d]));
					
				};
				
			};
			
		</script>
		
	</head>

	<body>

		<div>
			<div>Q1</div>
			<div>
				<input type="text" name="Q1" />
			</div>
		</div>

		<div>
			<div>Q2</div>
			<div>
				<input type="text" name="Q2" />
			</div>
		</div>
		
		<div>
			<div>Q3</div>
			<div>
				<input type="text" name="Q3" />
			</div>
		</div>

		<button onpointerdown="process();">Finish and Send</button>
	
	</body>
	
</html>
